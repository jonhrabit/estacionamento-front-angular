<div class="m-2">
  <h1>Acessos</h1>
  <app-spin [show]="loading" [size]="48"></app-spin>
  <div *ngIf="!loading">
    <button class="btn btn-success mb-3" (click)="novoAcesso()">Novo Acesso</button>
    <div class="mb-3" ngbAccordion>
      <div ngbAccordionItem [collapsed]="true">
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton>Filtro</button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <ng-template>

              <div class="row mb-2">
                <div class="col">
                  <input type="text" class="form-control" placeholder="ID" [(ngModel)]="filtroAcesso.id"
                    (input)="aplicarFiltroAvancado()">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Entrada" [(ngModel)]="filtroAcesso.entrada"
                    (input)="aplicarFiltroAvancado()">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Saída" [(ngModel)]="filtroAcesso.saida"
                    (input)="aplicarFiltroAvancado()">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Observação" [(ngModel)]="filtroAcesso.observacao"
                    (input)="aplicarFiltroAvancado()">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Placa" [(ngModel)]="filtroAcesso.placa"
                    (input)="aplicarFiltroAvancado()">
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Proprietário"
                    [(ngModel)]="filtroAcesso.proprietario" (input)="aplicarFiltroAvancado()">
                </div>
              </div>
              <div>
                <button class="btn btn-success m-3" (click)="exportarDados()">Exportar dados...</button>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
      <div ngbAccordionItem [collapsed]="true">
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton>Consulta</button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <ng-template>
              <div class="row mb-2">
                <div class="col">
                  <input type="date" class="form-control" placeholder="Início" [(ngModel)]="filtroAcesso.entrada">
                </div>
                <div class="col">
                  <input type="datetime" class="form-control" placeholder="Final" [(ngModel)]="filtroAcesso.entrada">
                </div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

    </div>
    <div *ngIf="acessosFiltrados.length === 0">
      <div class="alert alert-info">Nenhum acesso encontrado.</div>
    </div>
    <div class="mb-2 text-end" *ngIf="acessosFiltrados.length > 0">
      <small>Total de registros: {{ acessosFiltrados.length }}</small>
    </div>
    <table class="table table-striped" *ngIf="acessosFiltrados.length > 0">
      <thead>
        <tr>
          <th (click)="ordenarPor('id')" style="cursor:pointer">ID <span *ngIf="colunaOrdenacao==='id'">{{
              direcaoOrdenacao==='asc' ? '▲' : '▼' }}</span></th>
          <th (click)="ordenarPor('proprietario')" style="cursor:pointer">Proprietário <span
              *ngIf="colunaOrdenacao==='proprietario'">{{ direcaoOrdenacao==='asc' ? '▲' : '▼' }}</span></th>
          <th (click)="ordenarPor('placa')" style="cursor:pointer">Veículo <span *ngIf="colunaOrdenacao==='placa'">{{
              direcaoOrdenacao==='asc' ? '▲' : '▼' }}</span></th>
          <th (click)="ordenarPor('entrada')" style="cursor:pointer">Data Entrada <span
              *ngIf="colunaOrdenacao==='entrada'">{{ direcaoOrdenacao==='asc' ? '▲' : '▼' }}</span></th>
          <th (click)="ordenarPor('saida')" style="cursor:pointer">Data Saída <span *ngIf="colunaOrdenacao==='saida'">{{
              direcaoOrdenacao==='asc' ? '▲' : '▼' }}</span></th>
          <th (click)="ordenarPor('observacao')" style="cursor:pointer">Observação <span
              *ngIf="colunaOrdenacao==='observacao'">{{ direcaoOrdenacao==='asc' ? '▲' : '▼' }}</span></th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let acesso of acessosPaginados">
          <td>{{ acesso.id }}</td>
          <td>{{ acesso.veiculo?.pessoa.nome }}</td>
          <td>{{ acesso.veiculo?.placa }}</td>
          <td>{{ acesso.entrada | date:'short' }}</td>
          <td>{{ acesso.saida | date:'short'}}</td>
          <td>{{ acesso.observacao }}</td>
          <td>
            <button class="btn btn-sm btn-primary me-2" (click)="abrirModalEdicao(acesso)"><i
                class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-danger" (click)="excluirAcesso(acesso)"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
    <nav *ngIf="acessosFiltrados.length > itensPorPagina">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="paginaAtual === 1">
          <button class="page-link" (click)="paginaAtual = paginaAtual - 1"
            [disabled]="paginaAtual === 1">Anterior</button>
        </li>
        <li class="page-item" *ngFor="let pagina of paginasPaginacao" [class.active]="paginaAtual === pagina">
          <button class="page-link" (click)="paginaAtual = pagina">{{ pagina }}</button>
        </li>
        <li class="page-item" [class.disabled]="paginaAtual === totalPaginas">
          <button class="page-link" (click)="paginaAtual = paginaAtual + 1"
            [disabled]="paginaAtual === totalPaginas">Próxima</button>
        </li>
      </ul>
    </nav>
  </div>
</div>
